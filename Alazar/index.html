<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Alazar digitizers - InstrumentControl.jl</title>
      
      
      
      
        <meta name="author" content="Andrew Keller, Vinicius Ferreira">
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="InstrumentControl.jl">
    <meta property="og:image" content="None/../">
    <meta name="apple-mobile-web-app-title" content="InstrumentControl.jl">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-a422ff04cc.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../assets/Documenter.css">
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-indigo palette-accent-blue">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Instruments <i class="icon icon-link"></i>
              
            
          </span>
        
        Alazar digitizers
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/PainterQubits/InstrumentControl.jl" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          InstrumentControl.jl
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          PainterQubits/InstrumentControl.jl
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/PainterQubits/InstrumentControl.jl/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/PainterQubits/InstrumentControl.jl/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Overview</span>
    <ul>
      
        
  <li>
    <a class="" title="Design Summary" href="../design/">
      Design Summary
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Instruments/Measurements" href="../ins_meas/">
      Instruments/Measurements
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Sweep Jobs" href="../sweep/">
      Sweep Jobs
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Implementation" href="../implementation/">
      Implementation
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Instruments</span>
    <ul>
      
        
  <li>
    <a class="current" title="Alazar digitizers" href="./">
      Alazar digitizers
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Usage" href="#usage">
                Usage
              </a>
            </li>
          
            <li class="anchor">
              <a title="Technical details" href="#technical-details">
                Technical details
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <span class="section">Waveform generators</span>
    <ul>
      
        
  <li>
    <a class="" title="AWG5014C" href="../waveform_generator/awg5014c/">
      AWG5014C
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">VNAs</span>
    <ul>
      
        
  <li>
    <a class="" title="VNAs" href="../vna/vna/">
      VNAs
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="E5071C" href="../vna/e5071c/">
      E5071C
    </a>
    
  </li>

      
    </ul>
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Miscellaneous</span>
    <ul>
      
        
  <li>
    <a class="" title="Documentation building" href="../docbuild/">
      Documentation building
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Release notes" href="../releases/">
      Release notes
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="License" href="../LICENSE/">
      License
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <p><a id='Alazar-digitizers-1'></a></p>
<h1 id="alazar-digitizers">Alazar digitizers</h1>
<p>We put all Alazar digitizers in module <code>AlazarModule</code>; the feature set and API is so similar for the various models that just one module makes sense.</p>
<p>An <a href="./#InstrumentControl.AlazarModule.AlazarResponse"><code>AlazarResponse</code></a> type is given for each measurement mode of the digitizer. ("Traditional record mode" has not been implemented yet for lack of immediate need.) Additionally, one can define custom <code>AlazarResponse</code> types so that some custom computations or data reductions can be performed during acquisition. <a href="./#InstrumentControl.AlazarModule.IQSoftwareResponse"><code>IQSoftwareResponse</code></a> is a good example of this.</p>
<p>In the following discussion, it is important to understand some Alazar terminology. Newer Alazar digitizers use direct memory access (DMA) to stream data into a computer's RAM. A single <em>acquisition</em> uses one or many <em>buffers</em>, which constitute preallocated regions in the computer's physical memory. Each buffer contains one or many <em>records</em>. Each <em>record</em> contains many <em>samples</em>, which are the voltages measured by the digitizer. In streaming mode, there is only one record per buffer, but in other modes there can be many records per buffer.</p>
<p>Looking at the source code, it would seem that there is some redundancy in the types, for instance there is an <code>NPTRecordMode</code> and an <code>NPTRecordResponse</code> object. The former is used internally in the code to denote a particular method of configuring the instrument, mirroring the terminology used in the Alazar API documentation. The latter specifies what you actually want to do using that configuration of the instrument. Perhaps you want to measure in a given mode, but do some custom post-processing or processing during acquisition. <code>IQSoftwareResponse</code> is an example of this: it uses <code>NPTRecordMode</code> but reduces the data during measurement. Typically the user doesn't have to deal with the various mode objects, unless developing a new <code>AlazarResponse</code> type.</p>
<p><a id='Usage-1'></a></p>
<h2 id="usage">Usage</h2>
<p>Here are the currently defined <code>AlazarResponse</code> types you can use:</p>
<p><a id='InstrumentControl.AlazarModule.ContinuousStreamResponse' href='#InstrumentControl.AlazarModule.ContinuousStreamResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.ContinuousStreamResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>mutable struct ContinuousStreamResponse{S,T} &lt;: StreamResponse{S,T}
</pre></div>


<p>Response type implementing the "continuous streaming mode" of the Alazar API.</p>
<p>Usage example:</p>
<div class="codehilite"><pre><span></span>ats = AlazarATS9870()
samples_per_ch = 1024
res = ContinuousStreamResponse(ats, samples_per_ch)
measure(res)
</pre></div>


<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L34-L45' class='documenter-source'>source</a><br></p>
<p><a id='InstrumentControl.AlazarModule.TriggeredStreamResponse' href='#InstrumentControl.AlazarModule.TriggeredStreamResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.TriggeredStreamResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>mutable struct TriggeredStreamResponse{S,T} &lt;: StreamResponse{S,T}
</pre></div>


<p>Response type implementing the "triggered streaming mode" of the Alazar API.</p>
<p>Usage example:</p>
<div class="codehilite"><pre><span></span>ats = AlazarATS9870()
samples_per_ch = 1024
res = TriggeredStreamResponse(ats, samples_per_ch)
measure(res)
</pre></div>


<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L61-L72' class='documenter-source'>source</a><br></p>
<p><a id='InstrumentControl.AlazarModule.NPTRecordResponse' href='#InstrumentControl.AlazarModule.NPTRecordResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.NPTRecordResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>mutable struct NPTRecordResponse{S,T} &lt;: RecordResponse{S,T}
</pre></div>


<p>Response type implementing the "NPT record mode" of the Alazar API.</p>
<p>Usage example:</p>
<div class="codehilite"><pre><span></span>ats = AlazarATS9870()
samples_per_rec_per_ch = 1024
total_recs = 10
res = NPTRecordResponse(ats, sam_per_rec_per_ch, total_recs)
measure(res)
</pre></div>


<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L88-L100' class='documenter-source'>source</a><br></p>
<p><a id='InstrumentControl.AlazarModule.FFTHardwareResponse' href='#InstrumentControl.AlazarModule.FFTHardwareResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.FFTHardwareResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>mutable struct FFTHardwareResponse{S,T,U} &lt;: FFTResponse{S,T}
</pre></div>


<p>Response type implementing the FPGA-based "FFT record mode" of the Alazar API. Not all Alazar digitizers support this mode.</p>
<p>Usage example:</p>
<div class="codehilite"><pre><span></span>ats = AlazarATS9360()
samples_per_rec = 1024
sam_per_fft = 512
total_recs = 10
res = FFTHardwareResponse(ats, sam_per_rec, sam_per_fft, total_recs, Alazar.S32Real)
measure(res)
</pre></div>


<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L118-L132' class='documenter-source'>source</a><br></p>
<p><a id='InstrumentControl.AlazarModule.IQSoftwareResponse' href='#InstrumentControl.AlazarModule.IQSoftwareResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.IQSoftwareResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>mutable struct IQSoftwareResponse{S,T} &lt;: RecordResponse{S,T}
</pre></div>


<p>Response type for measuring with NPT record mode and mixing in software to find the phase and amplitude of a component at frequency <code>f</code>. Slower than doing it in an FPGA, but ultimately necessary if we want to use both channels as inputs to the FFT.</p>
<p>Usage example:</p>
<div class="codehilite"><pre><span></span>ats = AlazarATS9870()
samples_per_rec_per_ch = 1024
total_recs = 10
f = 100e6
res = IQSoftwareResponse(ats, samples_per_rec_per_ch, total_recs, f)
measure(res)
</pre></div>


<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L155-L170' class='documenter-source'>source</a><br></p>
<p>These definitions referenced some abstract types, described here:</p>
<p><a id='InstrumentControl.AlazarModule.AlazarResponse' href='#InstrumentControl.AlazarModule.AlazarResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.AlazarResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>abstract type AlazarResponse{S,T} &lt;: Response
</pre></div>


<p>Abstract <code>Response</code> from an Alazar digitizer instrument. Subtypes should implement <code>return_type</code> to specify the output array type if they rely on the generic method <code>measure(::AlazarResponse)</code>.</p>
<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L7-L12' class='documenter-source'>source</a><br></p>
<p><a id='InstrumentControl.AlazarModule.StreamResponse' href='#InstrumentControl.AlazarModule.StreamResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.StreamResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>abstract type StreamResponse{S,T} &lt;: AlazarResponse{S,T}
</pre></div>


<p>Abstract time-domain streaming <code>Response</code> from an Alazar digitizer instrument.</p>
<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L16-L19' class='documenter-source'>source</a><br></p>
<p><a id='InstrumentControl.AlazarModule.RecordResponse' href='#InstrumentControl.AlazarModule.RecordResponse'>#</a>
<strong><code>InstrumentControl.AlazarModule.RecordResponse</code></strong> &mdash; <em>Type</em>.</p>
<div class="codehilite"><pre><span></span>abstract type RecordResponse{S,T} &lt;: AlazarResponse{S,T}
</pre></div>


<p>Abstract time-domain record <code>Response</code> from an Alazar digitizer instrument.</p>
<p><a target='_blank' href='https://github.com/PainterQubits/InstrumentControl.jl/tree/f13df278e8fd3a01d42b75ef268a60d3d371abab/src/instruments/Digitizers/Alazar/ResponseTypes.jl#L22-L25' class='documenter-source'>source</a><br></p>
<p><a id='Technical-details-1'></a></p>
<h2 id="technical-details">Technical details</h2>
<p><a id='Digitizer-requirements-1'></a></p>
<h3 id="digitizer-requirements">Digitizer requirements</h3>
<p>The Alazar digitizers expect buffers in physical memory which are page-aligned. The size of each buffer should also be chosen appropriately.</p>
<p>The behavior of the digitizer is not specified when the buffer is made larger than 64 MB. On our computer, it seems like an <code>ApiWaitTimeout</code> error is thrown when the buffer is too large (for some unspecified definition of "large" greater than 64 MB). The digitizer will then throw <code>ApiInsufficientResources</code> errors whenever another acquisition is attempted, until the computer is restarted. Just restarting the Julia kernel, forcing a reload of the Alazar DLLs, does not appear to be enough to reset the digitizer fully.</p>
<p>For performance reasons, a buffer should not be made much smaller than 1 MB if mulitple buffers are required. There is also a minimum record size for each model of digitizer. For the ATS9360, if a record has fewer than 256 samples (could be 128 from channel A + 128 from channel B) then the acquisition will proceed, but return garbage data. Allocating too small of a buffer is therefore still bad, but less fatal than allocating one that is too large.</p>
<p><a id='How-to-allocate-appropriate-buffers-in-Julia-1'></a></p>
<h3 id="how-to-allocate-appropriate-buffers-in-julia">How to allocate appropriate buffers in Julia</h3>
<p>In Julia, just allocating an array will not necessarily return a page-aligned block in memory. The Alazar.jl package provides two array types to help with this. These arrays are not required to be created by the user.</p>
<ul>
<li><code>Alazar.PageAlignedVector</code> is just like <code>Base.Vector</code> except that the memory backing the array is guaranteed to be page-aligned.</li>
<li>The elements of an <code>Alazar.DMABufferVector</code> are pointers to different locations in memory which are page-aligned and can act as DMA buffers. The array is iterable and indexable as usual. The <code>Alazar.DMABufferVector</code> must itself be backed by a page-aligned array type, like <code>Alazar.PageAlignedVector</code> or <code>Base.SharedVector</code> (although support for <code>Base.SharedVector</code> is absent in InstrumentControl).</li>
</ul>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../implementation/" title="Implementation">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Implementation
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../waveform_generator/awg5014c/" title="AWG5014C">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                AWG5014C
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = 'PainterQubits/InstrumentControl.jl';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    
      <script src="../assets/mathjaxhelper.js"></script>
    
    
  </body>
</html>