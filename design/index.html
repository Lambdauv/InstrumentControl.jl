<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Design - PainterQB.jl</title>
      
      
      
      
        <meta name="author" content="Andrew Keller">
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="PainterQB.jl">
    <meta property="og:image" content="None/../">
    <meta name="apple-mobile-web-app-title" content="PainterQB.jl">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../None">
    <link rel="icon" type="image/x-icon" href="../None">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-54f87043f3.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../assets/Documenter.css">
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-indigo palette-accent-blue">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Overview <i class="icon icon-link"></i>
              
            
          </span>
        
        Design
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/ajkeller34/PainterQB.jl" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          PainterQB.jl
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          ajkeller34/PainterQB.jl
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/ajkeller34/PainterQB.jl/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/ajkeller34/PainterQB.jl/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Overview</span>
    <ul>
      
        
  <li>
    <a class="current" title="Design" href="./">
      Design
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="What should good measurement code do?" href="#what-should-good-measurement-code-do">
                What should good measurement code do?
              </a>
            </li>
          
            <li class="anchor">
              <a title="How do we take measurements?" href="#how-do-we-take-measurements">
                How do we take measurements?
              </a>
            </li>
          
            <li class="anchor">
              <a title="What is an instrument?" href="#what-is-an-instrument">
                What is an instrument?
              </a>
            </li>
          
            <li class="anchor">
              <a title="How do we configure instruments?" href="#how-do-we-configure-instruments">
                How do we configure instruments?
              </a>
            </li>
          
            <li class="anchor">
              <a title="Future directions" href="#future-directions">
                Future directions
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="Implementation" href="../implementation/">
      Implementation
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Instruments</span>
    <ul>
      
        
  <li>
    <a class="" title="AWG5014C" href="../awg5014c/">
      AWG5014C
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="E5071C" href="../e5071c/">
      E5071C
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Miscellaneous</span>
    <ul>
      
        
  <li>
    <a class="" title="Release notes" href="../releases/">
      Release notes
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="License" href="../LICENSE/">
      License
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <p><a id='Design-overview-1'></a></p>
<h1 id="design-overview">Design overview</h1>
<p><a id='What-should-good-measurement-code-do?-1'></a></p>
<h2 id="what-should-good-measurement-code-do">What should good measurement code do?</h2>
<p>Anyone who has written code in MATLAB or something comparable (IGOR Pro, in the author's case) has undoubtedly seen spaghetti code. Often there are many copies of a measurement routine that differ only slightly, perhaps in the functionality of what happens inside some for loop, etc.</p>
<p>We would like to have clear, reusable code to avoid redundancy and accidental errors, both of which consume precious time on the part of the experimenters. Consider an archetypal measurement scheme wherein we measure a device's response to various stimuli (perhaps we measure current as a function of applied bias). We should be able to write just one sweep function to do this:</p>
<div class="codehilite"><pre><span></span><span class="k">function</span><span class="nf"> sweep</span><span class="p">(</span><span class="n">ch0</span><span class="p">::</span><span class="n">Stimulus</span><span class="p">,</span> <span class="n">ch1</span><span class="p">::</span><span class="n">Response</span><span class="p">,</span> <span class="n">x_itr</span><span class="p">,</span> <span class="n">tstep</span><span class="p">)</span>
    <span class="n">map</span><span class="p">(</span><span class="n">x_itr</span><span class="p">)</span> <span class="k">do</span> <span class="n">x</span>
        <span class="n">source</span><span class="p">(</span><span class="n">ch0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="n">tstep</span><span class="p">)</span>
        <span class="n">measure</span><span class="p">(</span><span class="n">ch1</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>


<p>The idea of <em>multiple dispatch</em>, natively supported in Julia, permits writing such convenient and abstract code. This is just one example where the advantages of multiple dispatch are obvious. We hope it will more broadly simplify the extension of measurement code while ensuring continued reliability.</p>
<p><a id='How-do-we-take-measurements?-1'></a></p>
<h2 id="how-do-we-take-measurements">How do we take measurements?</h2>
<p><a id='Source-and-measure-1'></a></p>
<h3 id="source-and-measure">Source and measure</h3>
<p>Two functions are provided to abstract away many kinds of measurements: <code>source</code> and <code>measure</code>. In an experiment you source some stimulus and measure a response. Therefore <code>source</code> takes as an argument an object matching type signature <code>Stimulus</code>, which can have different fields for different types of stimuli, as well as some value. <code>measure</code> takes as an argument an object matching type signature <code>Response</code>. The idea is to write new subtypes of <code>Stimulus</code> and <code>Response</code> to describe what you are doing, as well as new methods for <code>source</code> and <code>measure</code>.</p>
<p><a id='Stimuli-1'></a></p>
<h3 id="stimuli">Stimuli</h3>
<p>All stimuli are objects, subtyped from the abstract <code>Stimulus</code> type. Many stimuli, associated with the capabilities of particular instruments, are already implemented.</p>
<p>Not all stimuli are associated with a physical instrument. For instance, sourcing a <code>DelayStimulus</code> will cause the script to block until a specified time after creation of the <code>DelayStimulus</code> object.</p>
<p>Stimuli could also be associated with several instruments. Maybe a stimulus that makes sense for a particular experiment would be to change all gate voltages at once. These gate voltages could of course be sourced by several physical instruments.</p>
<p><a id='Responses-1'></a></p>
<h3 id="responses">Responses</h3>
<p>All responses are objects, subtyped from the abstract parametric <code>Response{T}</code> type. We use a parametric type for responses so that the return type of the numerical data is clear. Usually a response is associated with a particular instrument.</p>
<p>However, responses need not come from instruments. For test purposes, suppose we want to mimic a measurement by generating random numbers. <code>RandomResponse</code> produces a random number in the unit interval when it is measured. A <code>TimerResponse</code> will measure the time since creation of the <code>TimerResponse</code> object.</p>
<p><a id='What-is-an-instrument?-1'></a></p>
<h2 id="what-is-an-instrument">What is an instrument?</h2>
<p>For the purposes of this package, an instrument is just something connected to the computer that we need to communicate with, and which can source or measure something. Every instrument may connect to the computer by different hardware, comms protocols, and command dialects.</p>
<p>All instruments are Julia objects, subtypes of the abstract type <code>Instrument</code>.</p>
<p><a id='Instrument-types-1'></a></p>
<h3 id="instrument-types">Instrument types</h3>
<p>Many instruments share the same communications protocols. We subtype <code>Instrument</code> based on these protocols.</p>
<p><a id='VISA-1'></a></p>
<h4 id="visa">VISA</h4>
<p>Many instruments are able to be addressed using the <a href="http://www.ivifoundation.org/docs/vpp432_2014-06-19.pdf">VISA</a> standard (Virtual Instrument Software Architecture), currently maintained by the IVI Foundation. <code>InstrumentVISA</code> is an abstract subtype of <code>Instrument</code>.</p>
<p>To talk to VISA instruments will require the Julia package <a href="http://www.github.com/ajkeller34/VISA.jl">VISA.jl</a> as well as the <a href="https://www.ni.com/visa/">National Instruments VISA libraries</a>. Installation instructions are available at each link.</p>
<p><a id='Alazar-digitizers-1'></a></p>
<h4 id="alazar-digitizers">Alazar digitizers</h4>
<p>Digitizers made by <a href="http://www.alazartech.com">AlazarTech</a> are notably <em>not</em> compatible with the VISA standard. All Alazar digitizers are addressable by an API supplied by the company, which talks to the card through a shared library (a .dll on Windows or .so on Linux). <code>InstrumentAlazar</code> is an abstract subtype of <code>Instrument</code>.</p>
<p>The shared library files and API documentation are only available from AlazarTech.</p>
<p><a id='How-do-we-configure-instruments?-1'></a></p>
<h2 id="how-do-we-configure-instruments">How do we configure instruments?</h2>
<p><a id='Properties-1'></a></p>
<h3 id="properties">Properties</h3>
<p>Instrument properties are configured and inspected using two functions, <code>setindex!</code> and <code>getindex</code>. This results in a convenient and concise syntax (<a href="https://groups.google.com/d/msg/julia-users/Dt6nbfhtaNQ/81KgQmttCwAJ">credit due to Oliver Schulz</a> for this idea).</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="n">awg</span><span class="p">[</span><span class="n">TriggerSlope</span><span class="p">]</span> <span class="o">=</span> <span class="p">:</span><span class="n">Rising</span>
<span class="n">awg</span><span class="p">[</span><span class="n">SampleRate</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10e6</span>
</pre></div>


<p><a id='Difference-between-stimuli-and-instrument-properties-1'></a></p>
<h3 id="difference-between-stimuli-and-instrument-properties">Difference between stimuli and instrument properties</h3>
<p>Because a stimulus is defined so broadly, the difference between a stimulus and an instrument property is not obvious. A stimulus is like a generalized instrument property: sourcing a stimulus may entail configuring zero or more instrument properties.</p>
<p>It is useful to think of a stimulus to be something that what you are measuring has a chance to react to. For example, this could be applied voltage, sourced by one or more instruments. The applied voltages would be seen by the device under test, which would respond accordingly. The stimulus could also just be a time delay, provided by the measurement computer. It could even be the number of threads used by Julia for real-time processing.</p>
<p>An instrument property is any persistent setting of an instrument. Tweaking an instrument property could affect the device under test, but it might not. Averaging is a good example. With averaging a measurement may look less noisy, but your device under test doesn't know the difference. The trigger engine of a digitizer would also have associated instrument properties.</p>
<p>In many cases there is an overlap between stimuli and properties. Consider that the frequency of a signal generator is an instrument property. In this case sourcing a frequency stimulus results in configuring an instrument property. Rather than make a <code>FrequencyStimulus</code> type, we provide a <code>PropertyStimulus</code> type which can be used more generically. Consider the following example, where we make a <code>PropertyStimulus</code> for sweeping the frequency of our E8257D signal generator:</p>
<div class="codehilite"><pre><span></span><span class="n">stim</span> <span class="o">=</span> <span class="n">PropertyStimulus</span><span class="p">(</span><span class="n">siggen</span><span class="p">::</span><span class="n">E8257D</span><span class="p">,</span> <span class="n">Frequency</span><span class="p">)</span>
<span class="k">for</span> <span class="n">freq</span> <span class="k">in</span> <span class="mf">1e9</span><span class="p">:</span><span class="mf">1e8</span><span class="p">:</span><span class="mf">5e9</span>     <span class="c"># 1 GHz to 5 GHz in steps of 100 MHz</span>
    <span class="n">source</span><span class="p">(</span><span class="n">stim</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span>
    <span class="c"># measure(something)</span>
<span class="k">end</span>
</pre></div>


<p>Note that <code>Frequency</code> is a subtype of <code>InstrumentProperty</code>, which is required for making a <code>PropertyStimulus</code>.</p>
<p>Again, stimuli need not be tied to a particular property. Rather, this is just one convenient and easily generalized example. In more complicated instances it is probably better to make a new <code>Stimulus</code> subtype rather than use <code>PropertyStimulus</code>.</p>
<p><a id='Future-directions-1'></a></p>
<h2 id="future-directions">Future directions</h2>
<p><a id='Feedback-loops-1'></a></p>
<h3 id="feedback-loops">Feedback loops</h3>
<p>In principle, asynchronous software feedback loops could be implemented with the <a href="http://www.github.com/shashi/Reactive.jl">Reactive.jl</a> package. This would probably only be suitable for slowly varying signals, e.g. PID temperature control. Ultimately benchmarking needs to be done to determine how useful this approach would be.</p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href=".." title="Home">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Home
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../implementation/" title="Implementation">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Implementation
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = 'ajkeller34/PainterQB.jl';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    
      <script src="../assets/mathjaxhelper.js"></script>
    
    
  </body>
</html>